# RWildbook Transition Plan

## Executive Summary

This document outlines the step-by-step plan for archiving the current RWildbook repository and replacing it with the new codebase from `wildbook-r-client`, while preserving the RWildbook package name.

**Current State:**
- Repository: `WildMeOrg/RWildbook`
- Package: RWildbook v0.9.3
- Target: Wildbook legacy framework (JDOQL queries)
- Key functions: `searchWB()`, `WBjdoql()`, `markedData()`

**Target State:**
- Repository: `WildMeOrg/RWildbook` (same)
- Package: RWildbook v1.0.0 (rewrite)
- Target: Wildbook v3 API (REST/OpenSearch)
- Key features: R6 `WildbookClient` class, modern query helpers

## Overview

### Why This Transition?

The legacy RWildbook package (v0.9.3) was designed for the original Wildbook framework using JDOQL queries. The new `wildbook-r-client` package provides:

1. **Modern API**: Built for Wildbook v3 REST API
2. **Better Architecture**: R6 class-based design with httr2
3. **Improved Testing**: 78 comprehensive tests with 100% pass rate
4. **Feature Parity**: Aligned with Python client
5. **Better Documentation**: Comprehensive examples and guides
6. **Active Development**: Recent bug fixes and improvements

### Key Differences

| Aspect | Legacy RWildbook | New RWildbook |
|--------|-----------------|---------------|
| Version | 0.9.3 | 1.0.0 |
| API Target | Wildbook legacy (JDOQL) | Wildbook v3 (REST) |
| Architecture | Procedural functions | R6 class-based |
| HTTP Library | base utils | httr2 |
| Dependencies | jsonlite, data.table, utils, marked | httr2, jsonlite, R6 |
| Main Interface | `searchWB()` | `WildbookClient$new()` |
| Query Type | JDOQL strings | OpenSearch/Elasticsearch JSON |
| Tests | Limited | 78 comprehensive tests |
| Documentation | 2 vignettes, design PDF | README, examples, testing guide |

### Breaking Changes for Users

Users will need to update their code:

**Old:**
```r
library(RWildbook)
data <- searchWB(URL="http://example.com", ...)
```

**New:**
```r
library(RWildbook)
client <- WildbookClient$new("http://example.com")
client$login("user@example.com", "password")
results <- client$search_encounters(match_all(), size = 10)
client$logout()
```

---

## Pre-Transition Checklist

### 1. Repository Backup
- [ ] Ensure all current RWildbook code is committed
- [ ] Create a final release tag (v0.9.3) if not already present
- [ ] Export all issues and discussions (if any)
- [ ] Document any pending PRs or work in progress

### 2. Documentation Preservation
- [ ] Archive the current README.md content
- [ ] Archive RWildbook_Design_Document.pdf
- [ ] Archive vignettes (demo1, demo2)
- [ ] Archive test data (vignette_1_data.rda, vignette_2_data.rda)

### 3. Communication Preparation
- [ ] Identify all current users/stakeholders
- [ ] Prepare migration guide for users
- [ ] Draft announcement for package rewrite
- [ ] Update GitHub repository description

### 4. wildbook-r-client Preparation
- [ ] Verify all tests pass (78 tests)
- [ ] Review and update DESCRIPTION for RWildbook branding
- [ ] Ensure LICENSE is appropriate (check GPL vs MIT)
- [ ] Review all documentation for accuracy

---

## Step-by-Step Transition Process

### Phase 1: Archive Legacy Code (1 day)

#### 1.1 Create Archive Branch
```bash
cd /Users/kirk/projects/CXL/wildme/RWildbook

# Create and push archive branch
git checkout -b archive/v0.9.3-legacy
git push origin archive/v0.9.3-legacy

# Create git tag for legacy version
git tag -a v0.9.3-legacy -m "Legacy RWildbook before v1.0 rewrite"
git push origin v0.9.3-legacy
```

#### 1.2 Create Legacy Archive Directory
```bash
# Return to master
git checkout master

# Create archive directory for historical reference
mkdir -p archive/legacy-v0.9.3
cp -r RWildbook/ archive/legacy-v0.9.3/
cp RWildbook_Design_Document.pdf archive/legacy-v0.9.3/
cp -r Testing/ archive/legacy-v0.9.3/
```

#### 1.3 Create Migration Guide
- [ ] Document API changes in `MIGRATION_GUIDE.md`
- [ ] Provide side-by-side code examples
- [ ] Explain why the change was necessary
- [ ] List support resources for migration help

### Phase 2: Prepare New Codebase (1 day)

#### 2.1 Rename Package from wildbookr to RWildbook

**Files to update:**

1. **DESCRIPTION** (line 1)
   - Change: `Package: wildbookr` → `Package: RWildbook`

2. **README.md**
   - Change all references: `wildbookr` → `RWildbook`
   - Change: `library(wildbookr)` → `library(RWildbook)`
   - Update package title and description
   - Update GitHub URLs to WildMeOrg/RWildbook

3. **NAMESPACE**
   - Review exported functions (should be auto-generated by roxygen2)

4. **R/client.R**
   - Update roxygen2 `@name` tags if needed
   - Update package references in documentation

5. **R/queries.R**
   - Update roxygen2 `@name` tags if needed
   - Update package references in documentation

6. **examples/*.R**
   - Change: `library(wildbookr)` → `library(RWildbook)`

7. **tests/testthat.R**
   - Change: `library(wildbookr)` → `library(RWildbook)`

8. **tests/testthat/test-*.R**
   - Change: `library(wildbookr)` → `library(RWildbook)`

9. **.Rproj file**
   - Rename: `wildbook-r-client.Rproj` → `RWildbook.Rproj`

#### 2.2 Update Package Metadata

**DESCRIPTION updates:**
```r
Package: RWildbook
Type: Package
Title: Interface for the 'Wildbook' Wildlife Data Management Framework
Version: 1.0.0
Authors@R: c(
    person("Wild Me", email = "dev@wildme.org", role = c("aut", "cre")),
    person("Simon", "Bonner", email = "sbonner6@uwo.ca", role = "ctb"),
    person("Xinxin", "Huang", email = "xhuan63@uwo.ca", role = "ctb")
)
Description: Provides an R interface to the 'Wildbook' v3 API for wildlife
    photo-identification data management. Includes functions for authentication,
    searching encounters and individuals, and constructing complex queries.
    This is a complete rewrite of the legacy RWildbook package to support
    the modern Wildbook v3 API architecture.
License: MIT + file LICENSE
Encoding: UTF-8
LazyData: true
RoxygenNote: 7.2.0
Depends:
    R (>= 4.0.0)
Imports:
    httr2 (>= 1.0.0),
    jsonlite (>= 1.8.0),
    R6 (>= 2.5.0)
Suggests:
    testthat (>= 3.0.0),
    httptest2,
    withr,
    knitr,
    rmarkdown
VignetteBuilder: knitr
URL: https://github.com/WildMeOrg/RWildbook
BugReports: https://github.com/WildMeOrg/RWildbook/issues
```

**Note:** Original authors (Bonner, Huang) listed as contributors (ctb) to acknowledge their foundational work.

#### 2.3 License Considerations

**Decision:** Use MIT license (more permissive, consistent with other Wild Me projects)

**Current licenses:**
- Legacy RWildbook: GPL(>=2)
- wildbook-r-client: MIT + file LICENSE

**Action:**
- [x] Use MIT license from wildbook-r-client
- [ ] Copy LICENSE file from wildbook-r-client
- [ ] Update DESCRIPTION to use: `License: MIT + file LICENSE`

### Phase 3: Replace Repository Contents (1 day)

#### 3.1 Backup Current Master
```bash
# Already done in Phase 1, but verify
git tag -a v0.9.3-final -m "Final commit before v1.0 rewrite"
git push origin v0.9.3-final
```

#### 3.2 Clear Old Package Directory
```bash
cd /Users/kirk/projects/CXL/wildme/RWildbook

# Remove old package structure (keep .git, archive/, LICENSE, .gitignore)
git rm -r RWildbook/
git rm Testing/
git rm RWildbook_Design_Document.pdf
git commit -m "Remove legacy v0.9.3 package structure for v1.0 rewrite"
```

#### 3.3 Copy New Package Structure
```bash
# Copy from wildbook-r-client (excluding git metadata)
cp -r ../wildbook-r-client/R ./
cp -r ../wildbook-r-client/man ./
cp -r ../wildbook-r-client/examples ./
cp -r ../wildbook-r-client/tests ./
cp ../wildbook-r-client/DESCRIPTION ./
cp ../wildbook-r-client/NAMESPACE ./
cp ../wildbook-r-client/.Rbuildignore ./

# Copy documentation (after updating for RWildbook name)
cp ../wildbook-r-client/README.md ./
cp ../wildbook-r-client/ALIGNMENT.md ./docs/ 2>/dev/null || mkdir -p docs && cp ../wildbook-r-client/ALIGNMENT.md ./docs/
cp ../wildbook-r-client/COMPARISON.md ./docs/
cp ../wildbook-r-client/BUGFIXES.md ./docs/
cp ../wildbook-r-client/TESTING.md ./docs/

# Rename .Rproj file
mv wildbook-r-client.Rproj RWildbook.Rproj 2>/dev/null || echo "Already renamed or doesn't exist"
```

**Note:** The above commands should be run AFTER completing the renaming in Phase 2.

#### 3.4 Create docs/ Directory Structure
```bash
mkdir -p docs
# Move technical documentation to docs/
# Keep README.md at root for GitHub
```

#### 3.5 Update .gitignore
```bash
# Review and merge .gitignore files if needed
# Ensure R-specific patterns are included
```

### Phase 4: Create Transition Documentation (0.5 day)

**Note:** Migration guide and user notifications skipped (no active users).

#### 4.1 Update README.md
- [ ] Update GitHub URLs to WildMeOrg/RWildbook
- [ ] Update package name from wildbookr to RWildbook throughout
- [ ] Verify all examples reference RWildbook

#### 4.2 Create NEWS.md
```markdown
# RWildbook 1.0.0

## Major Changes

This is a complete rewrite of the RWildbook package to support the Wildbook v3 API.

### Breaking Changes

* Complete API redesign - see MIGRATION_GUIDE.md
* Now requires Wildbook v3 (not compatible with legacy Wildbook)
* New R6 class-based interface via `WildbookClient`
* Changed from JDOQL queries to OpenSearch/Elasticsearch queries
* Minimum R version increased to 4.0.0

### New Features

* Session-based authentication with automatic cookie management
* Powerful search capabilities using OpenSearch queries
* Helper functions for common query patterns
* R6 class-based design for clean OO interface
* Built with httr2 for reliable HTTP handling
* 78 comprehensive tests with 100% pass rate
* Full alignment with Python client

### Legacy Support

* Legacy v0.9.3 code archived in `archive/legacy-v0.9.3/`
* Legacy branch: `archive/v0.9.3-legacy`
* Legacy tag: `v0.9.3-legacy`

---

# RWildbook 0.9.3 (Legacy)

Last version supporting legacy Wildbook framework.
See archive/legacy-v0.9.3/ for historical code.
```


### Phase 5: Testing and Validation (1 day)

#### 5.1 Run Package Tests
```r
# In R
library(testthat)
library(RWildbook)

# Run all tests
test_dir("tests/testthat")
# Expected: [ FAIL 0 | WARN 0 | SKIP 1 | PASS 78 ]
```

#### 5.2 Build and Check Package
```r
# In R
devtools::document()  # Regenerate documentation
devtools::check()     # Run R CMD check
devtools::build()     # Build package tarball
```

```bash
# Or via command line
R CMD build .
R CMD check RWildbook_1.0.0.tar.gz
```

#### 5.3 Test Installation
```r
# Install from source
install.packages(".", repos = NULL, type = "source")

# Load and test
library(RWildbook)
?WildbookClient

# Run basic example
client <- WildbookClient$new("http://example.com")
# Should create client without errors
```

#### 5.4 Validate Examples
```bash
# Run example scripts
Rscript examples/basic_usage.R  # May need credentials
Rscript examples/advanced_search.R
```

### Phase 6: Commit and Push (0.5 day)

#### 6.1 Stage All Changes
```bash
git add .
git status  # Review all changes
```

#### 6.2 Commit with Detailed Message
```bash
git commit -m "Release v1.0.0: Complete rewrite for Wildbook v3 API

This is a major rewrite of RWildbook to support the Wildbook v3 API
architecture, replacing the legacy JDOQL-based interface.

Major changes:
- New R6 class-based interface (WildbookClient)
- Modern REST API using httr2
- OpenSearch/Elasticsearch query support
- 78 comprehensive tests (100% pass rate)
- Aligned with wildbook-python-client
- Environment variable support

Breaking changes:
- Not compatible with legacy Wildbook
- Complete API redesign (see MIGRATION_GUIDE.md)
- Minimum R version now 4.0.0

Legacy code preserved:
- Branch: archive/v0.9.3-legacy
- Tag: v0.9.3-legacy
- Directory: archive/legacy-v0.9.3/

For migration help, see MIGRATION_GUIDE.md
"
```

#### 6.3 Create Release Tag
```bash
git tag -a v1.0.0 -m "RWildbook v1.0.0 - Rewrite for Wildbook v3 API"
```

#### 6.4 Push to GitHub
```bash
git push origin master
git push origin v1.0.0
git push origin archive/v0.9.3-legacy
git push origin v0.9.3-legacy
```

### Phase 7: GitHub Repository Updates (0.5 day)

#### 7.1 Update Repository Settings
- [ ] Update repository description:
  - "R client for the Wildbook v3 API - wildlife photo-identification data management"
- [ ] Update topics/tags:
  - Add: `wildbook`, `wildlife`, `r-package`, `api-client`, `mark-recapture`
- [ ] Update website URL if applicable

#### 7.2 Create GitHub Release
- [ ] Go to Releases → Draft a new release
- [ ] Choose tag: v1.0.0
- [ ] Release title: "RWildbook v1.0.0 - Wildbook v3 API Rewrite"
- [ ] Description: Summarize changes (see NEWS.md)
- [ ] Attach built package tarball
- [ ] Mark as major release
- [ ] Publish release

#### 7.3 Update README Badges (if any)
- [ ] Add build status badge
- [ ] Add test coverage badge
- [ ] Add CRAN status badge (when applicable)

#### 7.4 Pin Important Issues/Discussions
- [ ] Create pinned issue: "Migrating from v0.9.3 to v1.0.0"
- [ ] Link to MIGRATION_GUIDE.md

### Phase 8: Final Documentation (0.5 day)

**Note:** User communication skipped (no active users).

#### 8.1 Documentation Cleanup
- [ ] Review all documentation for accuracy
- [ ] Ensure LICENSE file is correct (MIT)
- [ ] Verify GitHub URLs are updated

#### 8.2 Repository Polish
- [ ] Set up issue templates for bugs/features
- [ ] Add contributing guidelines if needed
- [ ] Update repository description and topics

---

## Post-Transition Tasks

### Immediate (Week 1)

- [ ] Monitor GitHub issues for migration problems
- [ ] Update documentation based on user feedback
- [ ] Fix any critical bugs discovered
- [ ] Consider creating migration helper scripts if needed

### Short-term (Month 1)

- [ ] Gather user feedback on new API
- [ ] Update examples based on real-world usage
- [ ] Consider adding vignettes for common workflows
- [ ] Evaluate CRAN submission (if desired)

### Medium-term (Months 2-3)

- [ ] Consider adding convenience functions for common patterns
- [ ] Optimize performance based on usage patterns
- [ ] Explore additional features (bulk operations, data export, etc.)
- [ ] Maintain alignment with Python client

### Long-term (6+ months)

- [ ] Regular maintenance and bug fixes
- [ ] Keep dependencies up to date
- [ ] Follow Wildbook v3 API evolution
- [ ] Consider community contributions

---

## Rollback Plan

If critical issues are discovered:

### Option 1: Hot Fix
```bash
# Create hot-fix branch from v1.0.0
git checkout -b hotfix/v1.0.1 v1.0.0
# Fix issue
# Test thoroughly
# Merge and release v1.0.1
```

### Option 2: Revert to Legacy (Emergency Only)
```bash
# Restore legacy code temporarily
git checkout archive/v0.9.3-legacy
git checkout -b emergency-restore
git push origin emergency-restore
# Update master to point to emergency-restore
# Communicate issue to users
# Work on fixing v1.0 in parallel
```

**Note:** Rollback should be last resort only for critical blocking issues.

---

## Success Criteria

The transition is considered successful when:

- [x] All 78 tests pass
- [ ] Package builds without errors or warnings
- [ ] Installation works on clean R environment
- [ ] Examples run successfully
- [ ] Documentation is complete and accurate
- [ ] Legacy code is safely archived
- [ ] Git history is preserved
- [ ] Users have clear migration path
- [ ] GitHub release is published
- [ ] Community is informed

---

## Timeline Estimate

| Phase | Duration | Dependencies |
|-------|----------|--------------|
| 1. Archive Legacy | 0.5 day | None |
| 2. Prepare New Code | 1 day | Phase 1 |
| 3. Replace Repository | 0.5 day | Phase 2 |
| 4. Create Documentation | 0.5 day | Phase 3 |
| 5. Testing & Validation | 1 day | Phase 4 |
| 6. Commit & Push | 0.5 day | Phase 5 |
| 7. GitHub Updates | 0.5 day | Phase 6 |
| 8. Final Documentation | 0.5 day | Phase 7 |
| **Total** | **4-5 days** | |

---

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| Users unable to migrate | Medium | High | Comprehensive migration guide, support |
| Breaking existing workflows | High | High | Clear communication, legacy branch |
| Installation issues | Low | Medium | Thorough testing, clear dependencies |
| Documentation gaps | Medium | Medium | User feedback, iterative updates |
| License conflicts | Low | High | Legal review before transition |
| Lost git history | Low | High | Careful git operations, backups |

---

## Resources Required

### Personnel
- R developer (package migration)
- Technical writer (documentation)
- Support staff (user assistance)
- Wild Me team (review and approval)

### Tools
- R >= 4.0.0
- RStudio (recommended)
- Git
- GitHub access
- Test Wildbook v3 instance (for validation)

---

## Appendix A: Verification Checklist

Before finalizing the transition:

### Code Quality
- [ ] All tests pass (78/78)
- [ ] No R CMD check warnings or errors
- [ ] No roxygen2 documentation warnings
- [ ] Code follows R style guidelines
- [ ] No hardcoded credentials or URLs in code

### Documentation
- [ ] README.md is accurate and complete
- [ ] All function documentation is up to date
- [ ] NEWS.md documents all changes
- [ ] MIGRATION_GUIDE.md is comprehensive
- [ ] Examples are tested and working
- [ ] License is clearly stated

### Repository
- [ ] .gitignore is appropriate
- [ ] No unnecessary files in repo
- [ ] Archive branch exists and is accessible
- [ ] Tags are properly created
- [ ] Commit messages are clear

### Communication
- [ ] Users are notified
- [ ] Migration guide is published
- [ ] Support team is briefed
- [ ] Wild Me documentation is updated

---

## Contact

For questions about this transition plan:
- **Technical:** dev@wildme.org
- **GitHub Issues:** https://github.com/WildMeOrg/RWildbook/issues
- **Community:** Wild Me Forum

---

**Document Version:** 1.0
**Created:** 2026-01-30
**Last Updated:** 2026-01-30
**Status:** Draft - Awaiting Review
